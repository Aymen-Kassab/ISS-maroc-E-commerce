<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Product Details</title>
        <link rel="stylesheet" href="css_client/client_pro_det.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    </head>
    <body>

        <header class="header">
            <div class="header-container">
            <a href="client_home.html" class="logo">ISS MAROC</a>
            <div class="search-container">
                <input type="text" class="search-bar" placeholder="Search..." />
                <button class="search-btn"><i class="fas fa-search"></i></button>
            </div>
            <div class="header-icons">
                <button class="icon-btn"><i class="fas fa-user"></i></button>
                <button class="icon-btn">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-badge">2</span>
                </button>
            </div>
            </div>
        </header>

        <main class="content-area">
            <div class="product-details-card">
            <div class="product-details-grid">

                <!-- Product Image -->
                <div class="product-image-large">
                <img src="https://via.placeholder.com/600x400" alt="Product Image" />
                <span class="product-badge gaming">Gaming</span>
                </div>

                <!-- Product Info -->
                <div class="product-details-info">
                <p class="product-category">Laptop</p>
                <h2 class="product-title">Acer Predator Helios 300</h2>

                <p class="product-specs">
                    <span class="spec-highlight">Intel Core i7</span> |
                    <span class="spec-highlight">16GB RAM</span> |
                    <span class="spec-highlight">512GB SSD</span> |
                    <span class="spec-highlight">RTX 3060</span>
                </p>

                <div class="product-price">
                    <span class="price-current">13,999 DH</span>
                    <span class="price-old">15,999 DH</span>
                </div>

                <div class="product-actions">
                    <button class="btn-primary">Add to Cart</button>
                    <button class="btn-secondary">Buy Now</button>
                </div>

                <div class="product-description">
                    <h3>Description</h3>
                    <p>
                    The Acer Predator Helios 300 is a powerful gaming laptop equipped with high-end specs including the Intel Core i7, NVIDIA RTX 3060, and fast SSD storage. Perfect for gaming, content creation, and performance-demanding tasks.
                    </p>
                </div>
                </div>

            </div>
            </div>
        </main>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const productId = params.get("id");
            const container = document.querySelector(".product-details-card");

            if (!productId) {
                container.innerHTML = `<div class="error">Produit non spécifié.</div>`;
                return;
            }

            fetch(`http://localhost:8080/api/network/${productId}`)
                .then(res => {
                if (!res.ok) throw new Error("Erreur lors du chargement du produit.");
                return res.json();
                })
                .then(product => {
                if (!product) {
                    container.innerHTML = `<div class="error">Produit introuvable.</div>`;
                    return;
                }

                // Prepare image url (first one or placeholder)
                let imageUrl = "https://via.placeholder.com/600x400";
                if (product.imageUrls && product.imageUrls.length > 0) {
                    imageUrl = product.imageUrls[0].startsWith("http")
                    ? product.imageUrls[0]
                    : `http://localhost:8080${product.imageUrls[0]}`;
                }

                // Prepare badge category with a lowercase class safe for CSS
                const badgeClass = product.model ? product.model.toLowerCase().replace(/\s+/g, '-') : "";

                // Build specs string with highlights
                const specs = [
                    product.type,
                    product.portsNum + " Ports",
                    product.speed,
                    product.managementType,
                    product.connectivity
                ].filter(Boolean).map(spec => `<span class="spec-highlight">${spec}</span>`).join(" | ");

                container.innerHTML = `
                    <div class="product-details-grid">

                    <!-- Product Image -->
                    <div class="product-image-large">
                        <img src="${imageUrl}" alt="${product.name || 'Produit'}" />
                        ${product.model ? `<span class="product-badge ${badgeClass}">${product.model}</span>` : ''}
                    </div>

                    <!-- Product Info -->
                    <div class="product-details-info">
                        <p class="product-category">${product.brand || ''}</p>
                        <h2 class="product-title">${product.name || ''}</h2>

                        <p class="product-specs">${specs}</p>

                        <div class="product-price">
                        <span class="price-current">${product.price} DH</span>
                        ${product.oldPrice ? `<span class="price-old">${product.oldPrice} DH</span>` : ''}
                        </div>

                        <div class="product-actions">
                        <button class="btn-primary">Add to Cart</button>
                        <button class="btn-secondary" onclick="buyNow(${product.id})">Buy Now</button>
                        </div>

                        <div class="product-description">
                        <h3>Description</h3>
                        <p>${product.description || 'Description non disponible.'}</p>
                        </div>
                    </div>

                    </div>
                `;
                document.querySelector(".btn-secondary").addEventListener("click", () => {
                            addToCart(product.id);
                        });

                document.querySelector(".btn-secondary").addEventListener("click", (e) => {
                    e.preventDefault();
                    // Use the product.id from the fetched product data
                    window.location.href = `/client_net_purchase.html?id=${product.id}`;
                });
                })
                .catch(error => {
                container.innerHTML = `<div class="error">Erreur: ${error.message}</div>`;
                console.error(error);
                });
            });
            function getCartProductCount() {
                const cart = JSON.parse(localStorage.getItem("cart")) || [];
                let total = 0;

                for (let item of cart) {
                    total += item.quantity;
                }

                return total;
            }

            document.querySelector(".cart-badge").innerText = getCartProductCount();
        </script>
    </body>
</html>