<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Your Cart - ISS MAROC</title>
        <link rel="stylesheet" href="css_client/client_cart.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    </head>
    <body>
        <header class="header">
            <div class="header-container">
                <a href="client_home.html" class="logo">ISS MAROC</a>
                <div class="header-icons">
                    <button class="icon-btn">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge">0</span>
                    </button>
                </div>
            </div>
        </header>
        <main class="cart-container">
            <div class="cart-header">
                <h1 class="cart-title">Votre panier</h1>
                <div class="cart-count"></div>
            </div>

            <div class="cart-summary" id="cartSummary">
                
            </div>

            <div class="cart-items" id="cartItems">
                <!-- Cart Item 1 -->
                
            </div>

            <div class="cart-actions">
                <a href="client_home.html" class="btn-secondary">
                    <i class="fas fa-arrow-left"></i> Retourner à la boutique
                </a>
            </div>
        </main>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                renderCartItems();
            });

            function renderCartItems() {
                const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
                const container = document.getElementById("cartItems");
                const totalContainer = document.getElementById("cartSummary");
                
                container.innerHTML = "";
                totalContainer.innerHTML = "";

                if (cartItems.length === 0) {
                    container.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h2>Votre panier est vide</h2>
                        <p>Commencez vos achats pour ajouter des articles à votre panier</p>
                        <br>
                        <a href="client_home.html" class="btn-primary" style="margin-top: 1rem;">Achetez maintenant</a>
                     </div>
                    `;
                    return;
                }

                let totalPrice = 0;

                cartItems.forEach(item => {
                    const itemTotal = parseFloat(item.price) * item.quantity;
                    totalPrice += itemTotal;

                    const card = document.createElement("div");
                    card.className = "cart-item";
                    card.innerHTML = `
                        <img src="${item.image}" alt="Product" class="cart-item-img">
                        <div class="cart-item-details">
                            <h3 class="cart-item-title">${item.name}</h3>
                            <p class="cart-item-category">${item.category}</p>
                        </div>
                        <div class="cart-item-price">${item.price} DH</div>
                        <div class="quantity-control">
                            <button class="btn-secondary" onclick="buyNow('${item.category}', ${item.id})">Acheter maintenant</button>
                        </div>
                        <button class="remove-item" onclick="removeFromCart(${item.id}, '${item.category}')">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;

                    container.appendChild(card);
                });

                totalContainer.innerHTML = `
                    <div class="cart-summary" id="cartSummary">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span>${totalPrice} DH</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping</span>
                            <span>Gratuit</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total</span>
                            <span>${totalPrice} DH</span>
                        </div>
                    </div>
                `;
            }

            // Remove item by id + category
            function removeFromCart(id, category) {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                cart = cart.filter(item => !(item.id === id && item.category === category));
                localStorage.setItem("cart", JSON.stringify(cart));
                renderCartItems();
            }

            function buyNow(category, id) {
                let targetPage = "";

                switch (category.toLowerCase()) {
                    case "ordinateur":
                        targetPage = `client_comp_purchase.html?id=${id}`;
                        break;
                    case "printer":
                        targetPage = `client_prn_purchase.html?id=${id}`;
                        break;
                    case "network":
                        targetPage = `client_net_purchase.html?id=${id}`;
                        break;
                    default:
                        alert("Aucune page de commande définie pour cette catégorie !");
                        return;
                }

                window.location.href = targetPage;
            }

        </script>
    </body>
</html>