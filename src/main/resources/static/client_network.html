<!DOCTYPE html>
    <html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ISS MAROC - Équipements Réseau</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="css_client/client_products.css">
        <link rel="icon" href="data:,">
    </head>
    <body>
        <!-- Header (Same as before) -->
        <header class="header">
            <div class="header-container">
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                
                <a href="client_home.html" class="logo"><img class="logo-img" src="logo/image.png" alt=""></a>
                
                <div class="search-container">
                    <input type="text" class="search-bar" placeholder="Rechercher des équipements réseau...">
                    <button class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="header-icons">
                    <a href="client_cart.html">
                        <button class="icon-btn">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-badge">0</span>
                        </button>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Main Sidebar -->
            <nav class="main-sidebar" id="mainSidebar">
                <ul class="sidebar-menu">
                    <li>
                        <a href="client_home.html">
                            <i class="fas fa-home"></i>
                            Accueil
                        </a>
                    </li>
                    
                    <!-- Computer Section with Dropdown -->
                    <li class="has-dropdown">
                        <a href="client_computer.html">
                            <i class="fas fa-desktop"></i>
                            Ordinateur
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="client_computer.html?category=Pc de Bureau"><i class="fas fa-desktop"></i> PC de Bureau</a></li>
                            <li><a href="client_computer.html?category=Pc Portable"><i class="fas fa-laptop"></i> PC Portable</a></li>
                            <li><a href="client_computer.html?category=Serveur"><i class="fas fa-server"></i> Serveur</a></li>
                        </ul>
                    </li>
                    
                    <!-- Printer Section with Dropdown -->
                    <li class="has-dropdown">
                        <a href="client_printer.html">
                            <i class="fas fa-print"></i>
                            Imprimants
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="client_printer.html?category=Imprimante à réservoirs rechargeables"><i class="fas fa-print"></i> Imprimante à réservoirs rechargeables</a></li>
                            <li><a href="client_printer.html?category=Multifonction Jet d'encre"><i class="fas fa-print"></i> Multifonction Jet d'encre</a></li>
                            <li><a href="client_printer.html?category=Imprimante Jet d'encre"><i class="fas fa-print"></i> Imprimante Jet d'encre</a></li>
                            <li><a href="client_printer.html?category=Imprimante Laser"><i class="fas fa-print"></i> Imprimante Laser</a></li>
                            <li><a href="client_printer.html?category=Multifonction Laser"><i class="fas fa-print"></i> Multifonction Laser</a></li>
                            <li><a href="client_printer.html?category=Traceur"><i class="fas fa-print"></i> Traceur</a></li>
                            <li><a href="client_printer.html?category=Imprimante A3 / A3+"><i class="fas fa-print"></i> Imprimante A3 / A3+</a></li>
                            <li><a href="client_printer.html?category=Imprimante matricielle"><i class="fas fa-print"></i> Imprimante matricielle</a></li>
                            <li><a href="client_printer.html?category=Imprimante Photo"><i class="fas fa-print"></i> Imprimante Photo</a></li>
                        </ul>
                    </li>
                    
                    <!-- Network Section with Dropdown -->
                    <li class="has-dropdown">
                        <a href="client_network.html" class="active">
                            <i class="fas fa-network-wired"></i>
                            Réseau
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="client_network.html?category=Switch"><i class="fas fa-ethernet"></i> Switch</a></li>
                            <li><a href="client_network.html?category=Routeur"><i class="fas fa-wifi"></i> Routeur</a></li>
                            <li><a href="client_network.html?category=Point d'Accès WiFi"><i class="fas fa-wifi"></i> Point d'Accès WiFi</a></li>
                            <li><a href="client_network.html?category=Modem Routeur"><i class="fas fa-wifi"></i> Modem Routeur</a></li>
                            <li><a href="client_network.html?category=Adaptateur Wi-Fi USB"><i class="fas fa-key"></i> Adaptateur Wi-Fi USB</a></li>
                            <li><a href="client_network.html?category=Range Extender"><i class="fa-solid fa-bolt"></i> Range Extender</a></li>
                            <li><a href="client_network.html?category=Transceiver"><i class="fa-solid fa-globe"></i> Transceiver</a></li>
                            <li><a href="client_network.html?category=Kit CPL"><i class="fa-solid fa-magnet"></i> Kit CPL</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <a href="client_contact.html">
                            <i class="fas fa-envelope"></i>
                            Contact
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Content Area - Network Equipment Listing -->
            <main class="content-area">
                <!-- Page Header -->
                <div class="page-header">
                    <h1>Équipements Réseau</h1>
                    <div class="breadcrumb">
                        <a href="#">Accueil</a> / <span>Réseau</span>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="filter-header">
                        <h3><i class="fas fa-filter"></i> Filtres</h3>
                        <button class="clear-filters" onclick="clearAllFilters()">
                            <i class="fas fa-times"></i> Effacer les filtres
                        </button>
                        <button id="filterToggleBtn" class="filter-toggle-btn" aria-expanded="false" aria-controls="filterGrid" aria-label="Toggle filters">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                    
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label class="filter-label">Catégorie</label>
                            <select class="filter-select" id="categoryFilter">
                                <option value="">Toutes les catégories</option>
                                <option value="Switch">Switch</option>
                                <option value="Routeur">Routeur</option>
                                <option value="Point d'Accès WiFi">Point d'Accès WiFi</option>
                                <option value="Modem Routeur">Modem Routeur</option>
                                <option value="Adaptateur Wi-Fi USB">Adaptateur Wi-Fi USB</option>
                                <option value="Range Extender">Range Extender</option>
                                <option value="Transceiver">Transceiver</option>
                                <option value="Kit CPL">Kit CPL</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Gamme de prix</label>
                            <select class="filter-select" id="priceFilter">
                                <option value="">Tous les prix</option>
                                <option value="0-500">0 - 500 DH</option>
                                <option value="500-1500">500 - 1,500 DH</option>
                                <option value="1500-3000">1,500 - 3,000 DH</option>
                                <option value="3000-8000">3,000 - 8,000 DH</option>
                                <option value="8000+">8,000+ DH</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Marque</label>
                            <select class="filter-select" id="brandFilter">
                                <option value="">Sélectionner une marque</option>
                                <option value="Cisco">Cisco</option>
                                <option value="HP">HP</option>
                                <option value="Altai">Altai</option>
                                <option value="Linksys">Linksys</option>
                                <option value="D-Link">D-Link</option>
                                <option value="TP-Link">TP-Link</option>
                                <option value="Ubiquiti">Ubiquiti</option>
                                <option value="Mercusys">Mercusys</option>
                                <option value="Aruba">Aruba</option>
                                <option value="HPE">HPE</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                        
                    <!--    <div class="filter-group">
                            <label class="filter-label">Vitesse</label>
                            <select class="filter-select" id="speedFilter" onchange="applyFilters()">
                                <option value="">Toutes les vitesses</option>
                                <option value="100mbps">100 Mbps</option>
                                <option value="1gbps">1 Gbps</option>
                                <option value="10gbps">10 Gbps</option>
                                <option value="wifi5">WiFi 5 (AC)</option>
                                <option value="wifi6">WiFi 6 (AX)</option>
                                <option value="wifi6e">WiFi 6E</option>
                            </select>
                        </div> -->
                    </div>
                </div>

                <!-- Products Section -->
                <div class="products-section">
                    <div class="products-header">
                        <div class="results-count">
                            <span id="resultsCount">21</span> équipements trouvés
                        </div>
                        
                        <div class="sort-section">
                            <div class="view-toggle">
                                <button class="view-btn active" onclick="toggleView('grid')">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button class="view-btn" onclick="toggleView('list')">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div class="products-grid" id="productsGrid">
                        <!-- Sample Network Equipment Products -->
                        
                    </div>
                </div>
            </main>
        </div>

        <!-- Overlay for mobile -->
        <div class="overlay" id="overlay" onclick="closeMobileMenu()"></div>
        <div id="popupMessage" style="
            display: none;
            position: fixed;
            top: 100px;      
            left: 50%;   
            transform: translateX(-50%);  
            background-color: #4caf50;
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            font-weight: bold;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        "></div>
        <script>
            // client_network.js
            document.addEventListener("DOMContentLoaded", function() {
                // Initialize the page
                loadNetwork();
                setupEventListeners();
                updateCartBadge();
                
                // Apply any URL filters
                applyUrlFilters();
            });

            function loadNetwork() {
                const container = document.getElementById("productsGrid");
                container.innerHTML = '<div class="loading">Chargement en cours...</div>';
                
                fetch("http://localhost:8080/api/network")
                    .then(response => {
                        if (!response.ok) throw new Error("Erreur de chargement des équipements réseau");
                        return response.json();
                    })
                    .then(data => {
                        container.innerHTML = "";
                        
                        if (!data || data.length === 0) {
                            container.innerHTML = '<div class="no-results">Aucun équipement réseau trouvé</div>';
                            return;
                        }
                        
                        // Store products globally for filtering
                        window.networkProducts = data;
                        
                        // Create cards for all products initially
                        data.forEach(product => {
                            const card = createNetworkCard(product);
                            container.appendChild(card);
                        });
                        
                        // Update results count
                        document.getElementById('resultsCount').textContent = data.length;
                        // Apply URL filters here AFTER loading products
                        const urlParams = new URLSearchParams(window.location.search);
                        const category = urlParams.get('category');
                        if (category) {
                            document.getElementById('categoryFilter').value = category;
                            applyFilters();
            }
                    })
                    .catch(error => {
                        console.error("Fetch error:", error);
                        container.innerHTML = `<div class="error">Erreur de chargement: ${error.message}</div>`;
                    });
            }

            function createNetworkCard(product) {
                const card = document.createElement('div');
                card.className = "product-card";
                
                // Set data attributes for filtering
                card.dataset.category = product.type;
                card.dataset.brand = product.brand;
                card.dataset.price = product.price;
                
                // Handle image URL
                let imageUrl = '/placeholder.svg';
                if (product.imageUrls && product.imageUrls.length > 0) {
                    imageUrl = product.imageUrls[0].startsWith('http') 
                        ? product.imageUrls[0] 
                        : `http://localhost:8080${product.imageUrls[0]}`;
                }

                // Create card HTML (matches your exact structure)
                card.innerHTML = `
                    <div class="product-image">
                        <img src="${imageUrl}" alt="${product.name}" loading="lazy">
                    </div>
                    <div class="product-info">
                        <div class="product-category">${product.type}</div>
                        <h3 class="product-title">${product.name}</h3>
                        <div style="white-space: pre-line;" class="product-specs">${product.description}</div>
                        <div class="product-price">
                            <span class="price-current">${product.price} DH</span>
                        </div>
                        <div class="product-actions">
                            <button class="btn-primary add-to-cart">
                                <i class="fas fa-shopping-cart wishlist"></i> Ajouter
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                card.querySelector('.add-to-cart').addEventListener('click', function(e) {
                    e.stopPropagation();
                    addToCart(product, imageUrl);
                });
                
                card.addEventListener('click', function(e) {
                    if (!e.target.closest('.add-to-cart')) {
                        window.location.href = `/client_net_det.html?id=${product.id}`;
                    }
                });
                
                return card;
            }

            function setupEventListeners() {
                // Filter event listeners
                document.getElementById('categoryFilter').addEventListener('change', applyFilters);
                document.getElementById('priceFilter').addEventListener('change', applyFilters);
                document.getElementById('brandFilter').addEventListener('change', applyFilters);
                
                // Search functionality
                document.querySelector('.search-btn').addEventListener('click', searchProducts);
                document.querySelector('.search-bar').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') searchProducts();
                });
                
                // Clear filters
                document.querySelector('.clear-filters').addEventListener('click', clearAllFilters);
                
                // View toggle
                document.querySelectorAll('.view-toggle .view-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        toggleView(this.classList.contains('active') ? 'grid' : 'list');
                    });
                });
                
                // Mobile menu toggle
                document.querySelector('.mobile-menu-toggle').addEventListener('click', toggleMobileMenu);
                document.getElementById('overlay').addEventListener('click', closeMobileMenu);
                
                // Dropdown menus in sidebar
                document.querySelectorAll('.has-dropdown').forEach(item => {
                    item.addEventListener('click', function(e) {
                        if (window.innerWidth <= 768) {
                            e.preventDefault();
                            this.classList.toggle('open');
                        }
                    });
                });
            }

            function applyUrlFilters() {
                const urlParams = new URLSearchParams(window.location.search);
                const category = urlParams.get('category');
                
                if (category) {
                    document.getElementById('categoryFilter').value = category;
                    applyFilters();
                }
            }

            function applyFilters() {
                const category = document.getElementById('categoryFilter').value;
                const priceRange = document.getElementById('priceFilter').value;
                const brand = document.getElementById('brandFilter').value;
                const searchTerm = document.querySelector('.search-bar').value.toLowerCase();
                
                const cards = document.querySelectorAll('.product-card');
                let visibleCount = 0;
                
                cards.forEach(card => {
                    const cardCategory = card.dataset.category;
                    const cardBrand = card.dataset.brand;
                    const cardPrice = parseFloat(card.dataset.price);
                    const cardTitle = card.querySelector('.product-title').textContent.toLowerCase();
                    const cardSpecs = card.querySelector('.product-specs').textContent.toLowerCase();
                    
                    // Check filter conditions
                    const categoryMatch = !category || cardCategory === category;
                    const brandMatch = !brand || cardBrand === brand;
                    const searchMatch = !searchTerm || 
                                    cardTitle.includes(searchTerm) || 
                                    cardSpecs.includes(searchTerm);
                    
                    // Check price range
                    let priceMatch = true;
                    if (priceRange) {
                        const [min, max] = priceRange.includes('+') 
                            ? [priceRange.replace('+', ''), null] 
                            : priceRange.split('-').map(Number);
                        
                        if (max) {
                            priceMatch = cardPrice >= min && cardPrice <= max;
                        } else {
                            priceMatch = cardPrice >= min;
                        }
                    }
                    
                    // Show/hide based on filters
                    if (categoryMatch && brandMatch && priceMatch && searchMatch) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Update results count
                document.getElementById('resultsCount').textContent = visibleCount;
                
                // Show no results message if needed
                const noResults = document.querySelector('.no-results');
                if (visibleCount === 0) {
                    if (!noResults) {
                        const container = document.getElementById('productsGrid');
                        const message = document.createElement('div');
                        message.className = 'no-results';
                        message.textContent = 'Aucun équipement ne correspond à vos critères';
                        container.appendChild(message);
                    }
                } else if (noResults) {
                    noResults.remove();
                }
            }

            function searchProducts() {
                applyFilters();
            }

            function clearAllFilters() {
                document.getElementById('categoryFilter').value = '';
                document.getElementById('priceFilter').value = '';
                document.getElementById('brandFilter').value = '';
                document.querySelector('.search-bar').value = '';
                
                applyFilters();
            }

            function sortProducts() {
                const sortValue = document.getElementById('sortSelect').value;
                const container = document.getElementById('productsGrid');
                const cards = Array.from(container.querySelectorAll('.product-card[style*="block"]'));
                
                cards.sort((a, b) => {
                    const aPrice = parseFloat(a.dataset.price);
                    const bPrice = parseFloat(b.dataset.price);
                    const aName = a.querySelector('.product-title').textContent;
                    const bName = b.querySelector('.product-title').textContent;
                    
                    switch(sortValue) {
                        case 'price-low': return aPrice - bPrice;
                        case 'price-high': return bPrice - aPrice;
                        case 'name': return aName.localeCompare(bName);
                        case 'newest': return (b.dataset.id || 0) - (a.dataset.id || 0);
                        default: return 0;
                    }
                });
                
                // Re-append sorted cards
                cards.forEach(card => container.appendChild(card));
            }

            function toggleView(viewType) {
                const grid = document.getElementById('productsGrid');
                const buttons = document.querySelectorAll('.view-toggle .view-btn');
                
                buttons.forEach(btn => btn.classList.remove('active'));
                
                if (viewType === 'list') {
                    grid.classList.add('list-view');
                    buttons[1].classList.add('active');
                } else {
                    grid.classList.remove('list-view');
                    buttons[0].classList.add('active');
                }
            }

            function addToCart(product, imageUrl) {
                const cart = JSON.parse(localStorage.getItem("cart")) || [];
                const existingItem = cart.find(item => item.id === product.id && item.category === "net");
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        category: 'Réseaux',
                        price: product.price,
                        description: `${product.brand} || ${product.model} || ${product.type} || ${product.portsNum} || ${product.speed} || Management type : ${product.managementType}`,
                        quantity: 1,
                        image: imageUrl,
                        addedAt: Date.now()
                    });
                }
                
                localStorage.setItem("cart", JSON.stringify(cart));
                updateCartBadge();
                showPopupMessage("Produit ajouté au panier !");
            }

            function showPopupMessage(message, duration = 3000) {
                const popup = document.getElementById('popupMessage');
                popup.textContent = message;
                popup.style.display = 'block';
                popup.style.opacity = '1';

                // Hide after duration ms with fade effect
                setTimeout(() => {
                    popup.style.opacity = '0';
                    // After transition ends, hide completely
                    setTimeout(() => {
                        popup.style.display = 'none';
                    }, 500); // matches CSS transition time
                }, duration);
            }

            function updateCartBadge() {
                const cart = JSON.parse(localStorage.getItem("cart")) || [];
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                document.querySelector('.cart-badge').textContent = totalItems;
            }

            function toggleMobileMenu() {
                document.getElementById('mainSidebar').classList.toggle('active');
                document.getElementById('overlay').classList.toggle('active');
            }

            function closeMobileMenu() {
                document.getElementById('mainSidebar').classList.remove('active');
                document.getElementById('overlay').classList.remove('active');
            }
        </script>
        <script src="js_client/client_computer.js"></script>
    </body>
</html>