<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ISS MAROC - Imprimants</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="css_client/client_printer.css">
        <link rel="icon" href="data:,">
    </head>
    <body>
        <!-- Header (Same as before) -->
        <header class="header">
            <div class="header-container">
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                
                <a href="client_home.html" class="logo">ISS MAROC</a>
                
                <div class="search-container">
                    <input type="text" class="search-bar" placeholder="Rechercher des imprimants...">
                    <button class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="header-icons">
                    <a href="client_cart.html">
                        <button class="icon-btn">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-badge">0</span>
                        </button>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Main Sidebar -->
            <nav class="main-sidebar" id="mainSidebar">
                <ul class="sidebar-menu">
                    <li>
                        <a href="client_home.html">
                            <i class="fas fa-home"></i>
                            Accueil
                        </a>
                    </li>
                    
                    <!-- Computer Section with Dropdown -->
                    <li class="has-dropdown">
                        <a href="client_computer.html">
                            <i class="fas fa-desktop"></i>
                            Ordinateur
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="client_computer.html?category=Pc de Bureau"><i class="fas fa-desktop"></i> PC de Bureau</a></li>
                            <li><a href="client_computer.html?category=Pc Portable"><i class="fas fa-laptop"></i> PC Portable</a></li>
                            <li><a href="client_computer.html?category=Serveur"><i class="fas fa-server"></i> Serveur</a></li>
                        </ul>
                    </li>
                    
                    <!-- Printer Section with Dropdown -->
                    <li class="has-dropdown">
                        <a href="client_printer.html">
                            <i class="fas fa-print"></i>
                            Imprimants
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="client_printer.html?category=Imprimante à réservoirs rechargeables"><i class="fas fa-print"></i> Imprimante à réservoirs rechargeables</a></li>
                            <li><a href="client_printer.html?category=Multifonction Jet d'encre"><i class="fas fa-print"></i> Multifonction Jet d'encre</a></li>
                            <li><a href="client_printer.html?category=Imprimante Jet d'encre"><i class="fas fa-print"></i> Imprimante Jet d'encre</a></li>
                            <li><a href="client_printer.html?category=Imprimante Laser"><i class="fas fa-print"></i> Imprimante Laser</a></li>
                            <li><a href="client_printer.html?category=Multifonction Laser"><i class="fas fa-print"></i> Multifonction Laser</a></li>
                            <li><a href="client_printer.html?category=Traceur"><i class="fas fa-print"></i> Traceur</a></li>
                            <li><a href="client_printer.html?category=Imprimante A3 / A3+"><i class="fas fa-print"></i> Imprimante A3 / A3+</a></li>
                            <li><a href="client_printer.html?category=Imprimante matricielle"><i class="fas fa-print"></i> Imprimante matricielle</a></li>
                            <li><a href="client_printer.html?category=Imprimante Photo"><i class="fas fa-print"></i> Imprimante Photo</a></li>
                        </ul>
                    </li>
                    
                    <!-- Network Section with Dropdown -->
                    <li class="has-dropdown">
                        <a href="client_network.html">
                            <i class="fas fa-network-wired"></i>
                            Réseau
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="#"><i class="fas fa-wifi"></i> Routeurs WiFi</a></li>
                            <li><a href="#"><i class="fas fa-ethernet"></i> Switchs</a></li>
                            <li><a href="#"><i class="fas fa-server"></i> Serveurs NAS</a></li>
                            <li><a href="#"><i class="fas fa-shield-alt"></i> Pare-feu</a></li>
                            <li><a href="#"><i class="fas fa-plug"></i> Câbles Réseau</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <a href="client_contact.html">
                            <i class="fas fa-envelope"></i>
                            Contact
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Content Area - Printer Listing -->
            <main class="content-area">
                <!-- Page Header -->
                <div class="page-header">
                    <h1>Imprimants</h1>
                    <div class="breadcrumb">
                        <a href="#">Accueil</a> / <span>Imprimants</span>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="filter-header">
                        <h3><i class="fas fa-filter"></i> Filtres</h3>
                        <button class="clear-filters" onclick="clearAllFilters()">
                            <i class="fas fa-times"></i> Effacer les filtres
                        </button>
                        <button id="filterToggleBtn" class="filter-toggle-btn" aria-expanded="false" aria-controls="filterGrid" aria-label="Toggle filters">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                    
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label class="filter-label">Catégorie</label>
                            <select class="filter-select" id="categoryFilter" onchange="applyFilters()">
                                <option value="">Sélectionner le type d'imprimante</option>
                                <option value="Imprimante à réservoirs rechargeables">Imprimante à réservoirs rechargeables</option>
                                <option value="Multifonction Jet d'encre">Multifonction Jet d'encre</option>
                                <option value="Imprimante Jet d'encre">Imprimante Jet d'encre</option>
                                <option value="Imprimante Laser">Imprimante Laser</option>
                                <option value="Multifonction Laser">Multifonction Laser</option>
                                <option value="Traceur">Traceur</option>
                                <option value="Imprimante A3 / A3+">Imprimante A3 / A3+</option>
                                <option value="Imprimante matricielle">Imprimante matricielle</option>
                                <option value="Imprimante Photo">Imprimante Photo</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Gamme de prix</label>
                            <select class="filter-select" id="priceFilter" onchange="applyFilters()">
                                <option value="">Tous les prix</option>
                                <option value="0-1000">0 - 1,000 DH</option>
                                <option value="1000-3000">1,000 - 3,000 DH</option>
                                <option value="3000-5000">3,000 - 5,000 DH</option>
                                <option value="5000-10000">5,000 - 10,000 DH</option>
                                <option value="10000+">10,000+ DH</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Marque</label>
                            <select class="filter-select" id="brandFilter" onchange="applyFilters()">
                                <option value="">Toutes les marques</option>
                                <option value="hp">HP</option>
                                <option value="canon">Canon</option>
                                <option value="epson">Epson</option>
                                <option value="brother">Brother</option>
                                <option value="samsung">Samsung</option>
                                <option value="xerox">Xerox</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Type d'impression</label>
                            <select class="filter-select" id="printTypeFilter" onchange="applyFilters()">
                                <option value="">Tous les types</option>
                                <option value="noir-blanc">Noir et blanc</option>
                                <option value="couleur">Couleur</option>
                                <option value="photo">Photo</option>
                                <option value="3d">3D</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div class="products-section">
                    <div class="products-header">
                        <div class="results-count">
                            <span id="resultsCount">18</span> imprimants trouvés
                        </div>
                        
                        <div class="sort-section">
                            <span class="sort-label">Trier par:</span>
                            <select class="sort-select" id="sortSelect" onchange="sortProducts()">
                                <option value="relevance">Pertinence</option>
                                <option value="price-low">Prix croissant</option>
                                <option value="price-high">Prix décroissant</option>
                                <option value="name">Nom A-Z</option>
                                <option value="newest">Plus récent</option>
                            </select>
                            
                            <div class="view-toggle">
                                <button class="view-btn active" onclick="toggleView('grid')">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button class="view-btn" onclick="toggleView('list')">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div class="products-grid" id="productsGrid">
                        <!-- Sample Printer Products -->
                        
                    </div>
                </div>
            </main>
        </div>

        <!-- Overlay for mobile -->
        <div class="overlay" id="overlay" onclick="closeMobileMenu()"></div>
        <script>
           // client_printer.js
            document.addEventListener("DOMContentLoaded", function() {
                // Load printers and apply any URL filters
                loadPrinters();
                
                // Initialize filter functionality
                setupFilters();
                
                // Initialize cart badge
                updateCartBadge();
            });

            function loadPrinters() {
                const container = document.getElementById("productsGrid");
                
                fetch("http://localhost:8080/api/printer")
                    .then(response => {
                        if (!response.ok) throw new Error("Erreur de chargement des imprimantes");
                        return response.json();
                    })
                    .then(data => {
                        container.innerHTML = ""; // Clear existing content

                        if (!data || data.length === 0) {
                            container.innerHTML = `<div class="no-results">Aucune imprimante trouvée</div>`;
                            return;
                        }

                        // Create printer cards
                        data.forEach(printer => {
                            const card = createPrinterCard(printer);
                            container.appendChild(card);
                        });

                        // Check for URL filters and apply them
                        const urlParams = new URLSearchParams(window.location.search);
                        const category = urlParams.get('category');
                        
                        if (category) {
                            document.getElementById('categoryFilter').value = category;
                            applyFilters();
                        }
                    })
                    .catch(error => {
                        console.error("Fetch error:", error);
                        container.innerHTML = `<div class="error">Erreur de chargement: ${error.message}</div>`;
                    });
            }

            function createPrinterCard(printer) {
                const card = document.createElement('div');
                card.className = "product-card";
                
                // Set data attributes for filtering
                card.dataset.category = printer.type;
                card.dataset.brand = printer.brand.toLowerCase();
                card.dataset.price = printer.price;
                
                // Determine print type (adjust based on your data structure)
                if (printer.type.toLowerCase().includes('photo')) {
                    card.dataset.printType = 'photo';
                } else if (printer.type.toLowerCase().includes('3d')) {
                    card.dataset.printType = '3d';
                } else {
                    card.dataset.printType = printer.isColor ? 'couleur' : 'noir-blanc';
                }

                // Set image URL (fallback to placeholder)
                let imageUrl = '/placeholder.svg';
                if (printer.imageUrls && printer.imageUrls.length > 0) {
                    imageUrl = printer.imageUrls[0].startsWith('http') 
                        ? printer.imageUrls[0] 
                        : `http://localhost:8080${printer.imageUrls[0]}`;
                }

                // Create card HTML (same structure as your original)
                card.innerHTML = `
                    <div class="product-image">
                        <img src="${imageUrl}" alt="${printer.name}" loading="lazy">
                    </div>
                    <div class="product-info">
                        <div class="product-category">${printer.type}</div>
                        <h3 class="product-title">${printer.name}</h3>
                        <div class="product-specs">Vitesse d'impression: ${printer.printSpeed}</div>
                        <div class="product-specs">Qualité d'impression: ${printer.resolution}</div>
                        <div class="product-specs">Impression recto/verso: ${printer.rectoVerso}</div>
                        <div class="product-specs">Connectivité: ${printer.connectivity}</div>
                        <div class="product-price">
                            <span class="price-current">${printer.price} DH</span>
                        </div>
                        <div class="product-actions">
                            <button class="btn-primary add-to-cart">
                                <i class="fas fa-shopping-cart"></i> Ajouter
                            </button>
                        </div>
                    </div>
                `;

                // Add click event for product details
                card.addEventListener("click", (e) => {
                    if (!e.target.closest('.add-to-cart')) {
                        window.location.href = `/client_prn_det.html?id=${printer.id}`;
                    }
                });

                // Add to cart functionality
                card.querySelector('.add-to-cart').addEventListener('click', function(e) {
                    e.stopPropagation();
                    addToCart(printer, imageUrl);
                });

                return card;
            }

            function setupFilters() {
                // Set up filter change events
                document.getElementById('categoryFilter').addEventListener('change', applyFilters);
                document.getElementById('priceFilter').addEventListener('change', applyFilters);
                document.getElementById('brandFilter').addEventListener('change', applyFilters);
                document.getElementById('printTypeFilter').addEventListener('change', applyFilters);
                
                // Clear filters button
                document.querySelector('.clear-filters').addEventListener('click', clearAllFilters);
                
                // Sort functionality
                document.getElementById('sortSelect').addEventListener('change', sortProducts);
                
                // View toggle buttons
                document.querySelector('.view-toggle button:first-child').addEventListener('click', () => toggleView('grid'));
                document.querySelector('.view-toggle button:last-child').addEventListener('click', () => toggleView('list'));
            }

            function applyFilters() {
                const category = document.getElementById('categoryFilter').value;
                const priceRange = document.getElementById('priceFilter').value;
                const brand = document.getElementById('brandFilter').value;
                const printType = document.getElementById('printTypeFilter').value;
                
                const cards = document.querySelectorAll('.product-card');
                let visibleCount = 0;
                
                cards.forEach(card => {
                    const cardCategory = card.dataset.category;
                    const cardBrand = card.dataset.brand;
                    const cardPrice = parseFloat(card.dataset.price);
                    const cardPrintType = card.dataset.printType;
                    
                    // Check each filter condition
                    const categoryMatch = !category || cardCategory === category;
                    const brandMatch = !brand || cardBrand === brand.toLowerCase();
                    const printTypeMatch = !printType || cardPrintType === printType;
                    
                    // Check price range
                    let priceMatch = true;
                    if (priceRange) {
                        const [min, max] = priceRange.split('-').map(Number);
                        if (max) {
                            priceMatch = cardPrice >= min && cardPrice <= max;
                        } else {
                            priceMatch = cardPrice >= min;
                        }
                    }
                    
                    // Show or hide card based on filters
                    if (categoryMatch && brandMatch && printTypeMatch && priceMatch) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Update results count
                document.getElementById('resultsCount').textContent = visibleCount;
                
                // Show no results message if needed
                const noResults = document.querySelector('.no-results');
                if (visibleCount === 0) {
                    if (!noResults) {
                        const container = document.getElementById('productsGrid');
                        const message = document.createElement('div');
                        message.className = 'no-results';
                        message.textContent = 'Aucune imprimante ne correspond à vos critères de recherche.';
                        container.appendChild(message);
                    }
                } else if (noResults) {
                    noResults.remove();
                }
            }

            function clearAllFilters() {
                document.getElementById('categoryFilter').value = '';
                document.getElementById('priceFilter').value = '';
                document.getElementById('brandFilter').value = '';
                document.getElementById('printTypeFilter').value = '';
                
                applyFilters();
            }

            function sortProducts() {
                const sortValue = document.getElementById('sortSelect').value;
                const container = document.getElementById('productsGrid');
                const cards = Array.from(container.querySelectorAll('.product-card[style*="block"]'));
                
                cards.sort((a, b) => {
                    const aPrice = parseFloat(a.dataset.price);
                    const bPrice = parseFloat(b.dataset.price);
                    const aName = a.querySelector('.product-title').textContent;
                    const bName = b.querySelector('.product-title').textContent;
                    
                    switch(sortValue) {
                        case 'price-low': return aPrice - bPrice;
                        case 'price-high': return bPrice - aPrice;
                        case 'name': return aName.localeCompare(bName);
                        case 'newest': return (b.dataset.id || 0) - (a.dataset.id || 0);
                        default: return 0;
                    }
                });
                
                // Re-append sorted cards
                cards.forEach(card => container.appendChild(card));
            }

            function toggleView(viewType) {
                const grid = document.getElementById('productsGrid');
                const viewBtns = document.querySelectorAll('.view-toggle button');
                
                viewBtns.forEach(btn => btn.classList.remove('active'));
                event.currentTarget.classList.add('active');
                
                if (viewType === 'list') {
                    grid.classList.add('list-view');
                } else {
                    grid.classList.remove('list-view');
                }
            }

            function addToCart(printer, imageUrl) {
                const cart = JSON.parse(localStorage.getItem("cart")) || [];
                const existingItem = cart.find(item => item.id === printer.id && item.category === "printer");

                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: printer.id,
                        name: printer.name,
                        category: 'printer',
                        price: printer.price,
                        description: `${printer.brand} ${printer.type} - ${printer.printSpeed} - ${printer.resolution}`,
                        quantity: 1,
                        image: imageUrl,
                        addedAt: Date.now()
                    });
                }

                localStorage.setItem("cart", JSON.stringify(cart));
                updateCartBadge();
                alert("Produit ajouté au panier !");
            }

            function updateCartBadge() {
                const cart = JSON.parse(localStorage.getItem("cart")) || [];
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                document.querySelector('.cart-badge').textContent = totalItems;
            }
        </script>
        <script src="js_client/client_printer.js"></script>
    </body>
</html>